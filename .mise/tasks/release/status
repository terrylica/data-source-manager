#!/usr/bin/env bash
#MISE description="Show current version info"
set -euo pipefail

echo "=== Version Status ==="

# Current version in pyproject.toml
PYPROJECT_VERSION=$(grep -E '^version = ' pyproject.toml | sed 's/version = "\(.*\)"/\1/')
echo "pyproject.toml: $PYPROJECT_VERSION"

# Latest git tag
LATEST_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "(none)")
echo "Latest tag: $LATEST_TAG"

# Commits since last tag
if [[ "$LATEST_TAG" != "(none)" ]]; then
    COMMITS=$(git log "$LATEST_TAG"..HEAD --oneline 2>/dev/null | wc -l | tr -d ' ')
    echo "Commits since: $COMMITS"

    if [[ "$COMMITS" -gt 0 ]]; then
        echo ""
        echo "Recent commits:"
        git log "$LATEST_TAG"..HEAD --oneline | head -10
    fi
else
    TOTAL=$(git log --oneline | wc -l | tr -d ' ')
    echo "Total commits: $TOTAL"
fi
