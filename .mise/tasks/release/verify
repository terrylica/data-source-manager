#!/usr/bin/env bash
#MISE description="Phase 4: Verify release artifacts"
#MISE depends=["release:version"]
set -euo pipefail

echo "=== Verifying Release ==="

# Get version from pyproject.toml
VERSION=$(grep -E '^version = ' pyproject.toml | sed 's/version = "\(.*\)"/\1/')
echo "Version: $VERSION"

# Check 1: Git tag exists
if git rev-parse "v$VERSION" &>/dev/null; then
    echo "✓ Tag v$VERSION exists"
else
    echo "✗ Tag v$VERSION not found"
    exit 1
fi

# Check 2: GitHub release exists
if gh release view "v$VERSION" &>/dev/null; then
    echo "✓ GitHub release v$VERSION exists"
else
    echo "✗ GitHub release v$VERSION not found"
    exit 1
fi

# Check 3: CHANGELOG updated
if grep -q "## \[$VERSION\]" CHANGELOG.md 2>/dev/null || grep -q "# $VERSION" CHANGELOG.md 2>/dev/null; then
    echo "✓ CHANGELOG.md updated"
else
    echo "⚠ CHANGELOG.md may not contain $VERSION entry"
fi

echo ""
echo "✓ Release v$VERSION verified"
