# mise configuration for data-source-manager
# See: https://mise.jdx.dev/
#
# IMPORTANT: Python 3.13 ONLY - never change this version
# Environment variables are loaded from .mise.local.toml (git-ignored)
# Create .mise.local.toml from .mise.local.toml.example for local development

[tools]
python = "3.13"  # CRITICAL: Do not change - project requires Python 3.13 exactly
node = "25"      # Required for semantic-release

[tasks.test]
description = "Run unit tests"
run = "uv run -p 3.13 pytest tests/unit/ -v"

[tasks."test:all"]
description = "Run all tests"
run = "uv run -p 3.13 pytest tests/ -v"

[tasks."test:integration"]
description = "Run integration tests (requires network)"
run = "uv run -p 3.13 pytest tests/integration/ -v"

[tasks."test:okx"]
description = "Run OKX API tests"
run = "uv run -p 3.13 pytest tests/okx/ -m okx -v"

[tasks.lint]
description = "Run ruff linter with auto-fix"
run = "uv run -p 3.13 ruff check --fix ."

[tasks.format]
description = "Format code with ruff"
run = "uv run -p 3.13 ruff format ."

[tasks.typecheck]
description = "Run type checking with pyright"
run = "uv run -p 3.13 pyright src/"

[tasks."test:coverage"]
description = "Run tests with coverage report"
run = "uv run -p 3.13 pytest --cov=src/data_source_manager --cov-report=html --cov-report=term-missing tests/unit/"

[tasks."check:all"]
description = "Run all checks (lint, format, typecheck)"
depends = ["lint", "format", "typecheck"]

[tasks.build]
description = "Build package distribution"
run = "uv build"

[tasks.clean]
description = "Clean build artifacts"
run = "rm -rf dist/ build/ *.egg-info src/*.egg-info"

# Documentation tasks
[tasks."docs:links"]
description = "Check documentation links (offline mode)"
run = "lychee --offline --root . ."

[tasks."docs:check"]
description = "Run all documentation checks"
depends = ["docs:links"]

# Release tasks are in .mise/tasks/release/ directory
# Run: mise run release:preflight, release:dry, release:full
